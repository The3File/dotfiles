#!/usr/bin/env bash

dryrun(){
    rsync -ai --delete --dry-run --exclude='.git/' $HOME/.config/{mimeapps.list,bspwm,sxhkd,dunst,i3,nvim,qutebrowser,polybar,ranger,wal,compton.conf} ~/dotfiles/.config/
    rsync -ai --delete --dry-run --exclude='.git/' $HOME/.Scripts $HOME/dotfiles/
    rsync -ai --delete --dry-run --exclude='.git/' $HOME/{.local/share/applications,.apps,.latexmkrc,.nvimrc,.profile,.searched,.oh-my-zsh,.vimrc,.xinitrc,.Xmodmap,.Xresources,.xsessionrc,.zprofile,.aliases,.zshrc,.bashrc,.bash_profile,.bash_prompt} $HOME/dotfiles/
    stty -echo
    printf "Push? (y/N)"
    read -rsn1 a
    stty echo
    [[ $a == y ]] && copy || printf "\nNo changes made.\n" && exit 0
}

copy(){
    printf "\n"
    stty echo
    rsync --delete -a --exclude='.git/' $HOME/.config/{mimeapps.list,bspwm,sxhkd,dunst,i3,nvim,qutebrowser,polybar,ranger,wal,compton.conf} ~/dotfiles/.config/
    rsync --delete -a --exclude='.git/' $HOME/.Scripts $HOME/dotfiles
    rsync --delete -a --exclude='.git/' $HOME/{.local/share/applications,.apps,.latexmkrc,.nvimrc,.profile,.searched,.oh-my-zsh,.vimrc,.xinitrc,.Xmodmap,.Xresources,.xsessionrc,.zprofile,.aliases,.zshrc,.bashrc,.bash_profile,.bash_prompt} $HOME/dotfiles/
    push
}

push(){
    cd ~/dotfiles/
    git add .
    read -p 'Commit message: '
    git commit -a -m "$REPLY"
    git push -u origin master
    exit 0
}
[[ $1 == push ]] && push
[[ -z $1 ]] && dryrun || printf "Unknown option: '$1'\n" && exit 1
