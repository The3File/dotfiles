#!/bin/bash
### Written by Filip Ringdal

main(){
	clear
	figlet -f big prokrastimer\
		| awk '{printf "\033[3%dm%s\034\n", 6, $0;}'
	printf "\n\e[1;37mIndtast minutter, du vil arbejde (standard er 25): \e[1;35m"
	read work
	printf "\e[1;37mIndtast minutter, du vil holde pause (standard er 5): \e[1;33m"
	read notwork
	printf "\e[1;37mIndtast hvor mange sessioner (standard er 2): "
	read antal
	printf "\e[1;37mTiming startet! (Stop med Ctrl+c)\n"
	if [ -z "$work" ];then
		work=25
	fi
	if [ -z "$notwork" ];then
		notwork=5
	fi
	if [ -z "$antal" ];then
		antal=2
	fi
	count="0"
	start_work
}

start_work(){
	stty -echo
	sec="1"
	start_time="$SECONDS"
	clear
	while [ $sec -gt 0 ]
	do
		sec="$((work*60-(SECONDS-start_time)))"
		printf "\r\e[1;35mTid arbejde tilbage: %02d:%02d"\
			"$((sec/60))" "$((sec%60))"
		sleep 1
	done
	work_done
}

work_done(){
	printf "\e[1;39m - Arbejde fuldført!"
	play ~/.Scripts/.pomodoro/bowl.wav 2>/dev/null
	let count=" (( count + 1 ))"
	if [ $antal -gt $count ];then
		printf "\n\e[1;33mTryk ENTER for at starte pause."
		stty echo
		read 2>/dev/null
		stty -echo
		start_notwork
	else
		if [ $((antal*work/60)) -gt 0 ];then
			timer="%2d timer og"
		else
			timer=""
		fi
		printf "\r                                                   "
		figlet -f big prokrastimer\
		| awk '{printf "\r\033[3%dm%s\034\n", 6, $0;}'
		printf "\n"
		printf "\r\e[1;33mDu har arbejdet i alt:$timer%2d min."\
			"$(((antal*work)/60))" "$(((antal*work)%60))"
		stty echo
		read 2>/dev/null
		exit 0
	fi
}

start_notwork(){
	stty -echo
	sec="1"
	start_time="$SECONDS"
	clear
	while [ $sec -gt 0 ]
	do
		current_time="$SECONDS"
		sec="$((notwork*60-(SECONDS-start_time)))"
		printf "\r\e[1;33mTid pause tilbage: %02d:%02d"\
			"$((sec/60))" "$((sec%60))"
		sleep 1
	done
	notwork_done
}

notwork_done(){
	printf "\e[1;39m - Pause overstået!"
	play ~/.Scripts/.pomodoro/bowl.wav 2>/dev/null
	printf "\n\e[1;35mTryk ENTER for at begynde arbejde."
	stty echo
	read 2>/dev/null
	stty -echo
	start_work
}
main
